# ğŸ›ï¸ EMall - Local Merchants Marketplace

<div align="center">

![EMall Logo](https://img.shields.io/badge/EMall-Marketplace-purple?style=for-the-badge)
![Next.js](https://img.shields.io/badge/Next.js-15-black?style=for-the-badge&logo=next.js)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue?style=for-the-badge&logo=typescript)
![Supabase](https://img.shields.io/badge/Supabase-Database-green?style=for-the-badge&logo=supabase)

**A modern marketplace platform connecting local merchants with customers**

[Features](#-features) â€¢ [Tech Stack](#-tech-stack) â€¢ [Installation](#-installation) â€¢ [Documentation](#-project-structure)

</div>

---

## ğŸ“– About EMall

### English
EMall is a comprehensive marketplace platform designed to empower local merchants in Egypt. It provides a complete e-commerce solution with innovative features like QR code pickup systems, tiered subscription plans, and automated rewards programs. The platform supports both delivery and pickup orders, with real-time notifications and payment processing through Stripe and Paymob.

### Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
Ø¥ÙŠÙ…ÙˆÙ„ Ù‡ÙŠ Ù…Ù†ØµØ© Ø³ÙˆÙ‚ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø´Ø§Ù…Ù„Ø© Ù…ØµÙ…Ù…Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠÙŠÙ† ÙÙŠ Ù…ØµØ±. ØªÙˆÙØ± Ø­Ù„Ø§Ù‹ Ù…ØªÙƒØ§Ù…Ù„Ø§Ù‹ Ù„Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ù…Ø¨ØªÙƒØ±Ø© Ù…Ø«Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ù€ QR CodeØŒ Ø®Ø·Ø· Ø§Ø´ØªØ±Ø§Ùƒ Ù…ØªØ¯Ø±Ø¬Ø©ØŒ ÙˆØ¨Ø±Ø§Ù…Ø¬ Ù…ÙƒØ§ÙØ¢Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©. ØªØ¯Ø¹Ù… Ø§Ù„Ù…Ù†ØµØ© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŒ Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø¹Ø¨Ø± Stripe Ùˆ Paymob.

---

## âœ¨ Features

### ğŸª For Merchants | Ù„Ù„ØªØ¬Ø§Ø±

#### Subscription Tiers | Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø©
- **Premium Tier (Yellow Badge)** - Top visibility, unlimited products
  - **Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… (Ø´Ø§Ø±Ø© Ø°Ù‡Ø¨ÙŠØ©)** - Ø£Ø¹Ù„Ù‰ Ø¸Ù‡ÙˆØ±ØŒ Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©
- **Standard Tier (Purple Badge)** - Enhanced features, 100 products max
  - **Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ (Ø´Ø§Ø±Ø© Ø¨Ù†ÙØ³Ø¬ÙŠØ©)** - Ù…Ù…ÙŠØ²Ø§Øª Ù…Ø­Ø³Ù†Ø©ØŒ Ø­ØªÙ‰ 100 Ù…Ù†ØªØ¬
- **Basic Tier (Blue Badge)** - Essential features, 50 products max
  - **Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø´Ø§Ø±Ø© Ø²Ø±Ù‚Ø§Ø¡)** - Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ø­ØªÙ‰ 50 Ù…Ù†ØªØ¬

#### Dashboard Features | Ù…Ù…ÙŠØ²Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
- ğŸ“Š **Real-time Analytics** - Sales tracking, revenue monitoring
  - **ØªØ­Ù„ÙŠÙ„Ø§Øª ÙÙˆØ±ÙŠØ©** - ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
- ğŸ“¦ **Product Management** - Add, edit, delete products with images
  - **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª** - Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ±
- ğŸ›’ **Order Management** - Process orders, update status
  - **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª** - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
- ğŸ” **QR Pickup Verification** - Scan or enter pickup codes
  - **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ù€ QR** - Ù…Ø³Ø­ Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…ÙˆØ² Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
- â­ **Rewards Dashboard** - Track pickup rewards and discounts
  - **Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª** - ØªØªØ¨Ø¹ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
- ğŸ”” **Real-time Notifications** - Instant order alerts
  - **Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©** - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©

### ğŸ›’ For Customers | Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡

#### Shopping Experience | ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚
- ğŸ  **Merchant Discovery** - Browse merchants by tier and category
  - **Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªØ¬Ø§Ø±** - ØªØµÙØ­ Ø§Ù„ØªØ¬Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„ÙØ¦Ø©
- ğŸ” **Advanced Search** - Filter by location, category, rating
  - **Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…** - ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„ÙØ¦Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…
- ğŸ“± **Product Catalogs** - View detailed product information
  - **ÙƒØªØ§Ù„ÙˆØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª** - Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
- ğŸ›ï¸ **Smart Cart** - Automatic merchant grouping
  - **Ø³Ù„Ø© Ø°ÙƒÙŠØ©** - ØªØ¬Ù…ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø¬Ø±
- ğŸ“¦ **Delivery Options** - Choose delivery or pickup
  - **Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„** - Ø§Ø®ØªØ± Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…

#### QR Pickup System | Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ù€ QR
- ğŸ« **6-Character Codes** - Unique alphanumeric pickup codes
  - **Ø±Ù…ÙˆØ² Ù…Ù† 6 Ø£Ø­Ø±Ù** - Ø±Ù…ÙˆØ² Ø§Ø³ØªÙ„Ø§Ù… ÙØ±ÙŠØ¯Ø©
- â±ï¸ **10-Minute Expiry** - Automatic expiration for security
  - **Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© 10 Ø¯Ù‚Ø§Ø¦Ù‚** - Ø§Ù†ØªÙ‡Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ù…Ø§Ù†
- ğŸ“· **QR Code Generation** - Scannable QR codes for merchants
  - **ØªÙˆÙ„ÙŠØ¯ QR Code** - Ø±Ù…ÙˆØ² Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù…Ø³Ø­ Ù„Ù„ØªØ¬Ø§Ø±
- âš¡ **Instant Rewards** - Automatic points on pickup completion
  - **Ù…ÙƒØ§ÙØ¢Øª ÙÙˆØ±ÙŠØ©** - Ù†Ù‚Ø§Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…

### ğŸ’³ Payment Processing | Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª

#### Dual Gateway Support | Ø¯Ø¹Ù… Ø¨ÙˆØ§Ø¨ØªÙŠ Ø¯ÙØ¹
- ğŸŒ **Stripe Integration** - International payments, subscriptions
  - **ØªÙƒØ§Ù…Ù„ Stripe** - Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø¯ÙˆÙ„ÙŠØ© ÙˆØ§Ø´ØªØ±Ø§ÙƒØ§Øª
- ğŸ‡ªğŸ‡¬ **Paymob Integration** - Egyptian market (card, wallet, cash)
  - **ØªÙƒØ§Ù…Ù„ Paymob** - Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…ØµØ±ÙŠ (Ø¨Ø·Ø§Ù‚Ø§ØªØŒ Ù…Ø­Ø§ÙØ¸ØŒ ÙƒØ§Ø´)
- ğŸ” **Webhook Verification** - Secure HMAC signature validation
  - **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Webhooks** - Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù…Ù† Ù…Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª
- ğŸ“ **Payment Logging** - Complete audit trail
  - **ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª** - Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚ ÙƒØ§Ù…Ù„

### ğŸ”” Notification System | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª

#### Real-time Updates | Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©
- âš¡ **Supabase Realtime** - Live notification subscriptions
  - **Supabase Ø§Ù„ÙÙˆØ±ÙŠ** - Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­ÙŠØ©
- ğŸ”Š **Toast Notifications** - Sonner for elegant toasts
  - **Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Toast** - Sonner Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù†ÙŠÙ‚Ø©
- ğŸ”” **Bell Component** - Unread count badge, dropdown menu
  - **Ù…ÙƒÙˆÙ† Ø§Ù„Ø¬Ø±Ø³** - Ø´Ø§Ø±Ø© Ø§Ù„Ø¹Ø¯Ø¯ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡ØŒ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø©
- ğŸµ **Sound Alerts** - Optional Web Audio API notifications
  - **ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØµÙˆØªÙŠØ©** - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ø¨Ù€ Web Audio
- ğŸ“§ **Email/SMS Ready** - Integration placeholders for SendGrid, Twilio
  - **Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ø±Ø³Ø§Ø¦Ù„** - Ø¬Ø§Ù‡Ø² Ù„Ù€ SendGrid Ùˆ Twilio

### ğŸ‘¨â€ğŸ’¼ Admin Panel | Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©

#### Management Tools | Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
- âœ… **Merchant Approval** - Review and approve applications
  - **Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¬Ø§Ø±** - Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- ğŸš« **Ban Management** - Suspend problematic merchants
  - **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¸Ø±** - ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ù…Ø´ÙƒÙ„ÙŠÙ†
- ğŸ“Š **Analytics Dashboard** - Platform-wide statistics
  - **Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª** - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©
- âš™ï¸ **Settings Control** - Platform configuration
  - **Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª** - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©

---

## ğŸ› ï¸ Tech Stack

### Frontend
- **Next.js 15** - App Router, Server Components, API Routes
- **TypeScript 5** - Full type safety
- **Tailwind CSS** - Utility-first styling
- **React 19** - Latest React features
- **Sonner** - Toast notifications
- **@yudiel/react-qr-scanner** - QR code scanning

### Backend & Database
- **Supabase** - PostgreSQL database, Auth, Storage, Realtime
- **Supabase Realtime** - Live notifications and subscriptions
- **Service Role** - Admin operations and webhooks

### Payment Gateways
- **Stripe** - International payments and subscriptions
  - Payment Intents API
  - Subscription Management
  - Webhook Events
- **Paymob** - Egyptian payment processing
  - Card payments
  - Mobile wallets
  - Cash on delivery
  - HMAC signature verification

### Libraries & Tools
- **QRCode** - QR code generation
- **Axios** - HTTP client for Paymob
- **React Hot Toast** - Toast notifications (legacy)
- **Next.js Image** - Optimized images

### Development Tools
- **ESLint** - Code linting
- **Git** - Version control
- **npm** - Package management

---

## ğŸ“‹ Prerequisites

Before you begin, ensure you have the following installed:

- **Node.js** >= 18.0.0
- **npm** >= 9.0.0 or **yarn** >= 1.22.0
- **Git** for version control
- **Supabase Account** - [Create one here](https://supabase.com)
- **Stripe Account** (optional) - [Sign up here](https://stripe.com)
- **Paymob Account** (optional) - [Register here](https://paymob.com)

---

## ğŸš€ Installation

### 1. Clone the Repository

```bash
git clone https://github.com/yuosef0/Emallv1.0.git
cd Emallv1.0
```

### 2. Install Dependencies

```bash
npm install
# or
yarn install
```

### 3. Environment Variables Setup

Create a `.env.local` file in the root directory:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# Stripe Configuration (Optional)
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Paymob Configuration (Optional)
PAYMOB_API_KEY=your_paymob_api_key
PAYMOB_INTEGRATION_ID=your_integration_id
PAYMOB_IFRAME_ID=your_iframe_id
PAYMOB_HMAC_SECRET=your_hmac_secret

# Optional: Email/SMS
SENDGRID_API_KEY=your_sendgrid_key
TWILIO_ACCOUNT_SID=your_twilio_sid
TWILIO_AUTH_TOKEN=your_twilio_token
```

### 4. Database Setup

#### Option A: Using Supabase Dashboard

1. Go to your Supabase project dashboard
2. Navigate to **SQL Editor**
3. Run the SQL schema file (if provided) or create tables manually

#### Required Tables:

**Users & Profiles:**
- `profiles` - User profiles with role (customer, merchant, admin)
- `users` - Extended user information (managed by Supabase Auth)

**Merchants:**
- `merchants` - Merchant information and settings
- `subscription_tiers` - Premium, Standard, Basic tiers
- `merchant_categories` - Custom product categories per merchant

**Products:**
- `products` - Product listings with images and prices
- `product_images` - Additional product images

**Orders:**
- `orders` - Order records with delivery/pickup info
- `order_items` - Individual items in orders
- `pickup_codes` - Generated QR pickup codes (can be in orders table)

**Rewards:**
- `pickup_rewards` - Customer reward points tracking
- `reward_tiers` - Bronze, Silver, Gold, Platinum tiers

**Notifications:**
- `notifications` - In-app notification records
- `webhook_logs` - Payment webhook audit trail

**Reviews:**
- `reviews` - Customer reviews for merchants/products

#### Database Triggers (Important!)

Create Supabase database trigger for automatic rewards:

```sql
-- Trigger function to add pickup rewards
CREATE OR REPLACE FUNCTION add_pickup_rewards()
RETURNS TRIGGER AS $$
BEGIN
  -- Check if pickup_code_used changed from FALSE to TRUE
  IF OLD.pickup_code_used = FALSE AND NEW.pickup_code_used = TRUE THEN
    -- Get customer's reward tier
    -- Calculate points based on tier
    -- Insert into pickup_rewards table
    -- Update customer total points
    -- Send notification
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create trigger
CREATE TRIGGER on_pickup_code_used
AFTER UPDATE ON orders
FOR EACH ROW
EXECUTE FUNCTION add_pickup_rewards();
```

#### Enable Supabase Realtime

```sql
-- Enable realtime for notifications table
ALTER TABLE notifications REPLICA IDENTITY FULL;
ALTER PUBLICATION supabase_realtime ADD TABLE notifications;
```

### 5. Storage Setup (Supabase)

Create storage buckets:

1. **merchant-logos** - For merchant logo images (public)
2. **merchant-covers** - For merchant cover images (public)
3. **product-images** - For product images (public)

Set appropriate bucket policies for public read access.

---

## ğŸƒâ€â™‚ï¸ Running Locally

### Development Mode

```bash
npm run dev
# or
yarn dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

### Build for Production

```bash
npm run build
npm run start
# or
yarn build
yarn start
```

### Linting

```bash
npm run lint
# or
yarn lint
```

---

## ğŸ§ª Testing

### Manual Testing Checklist

#### Authentication Flow
- [ ] User registration (customer, merchant)
- [ ] Email verification
- [ ] Login/logout
- [ ] Password reset

#### Customer Journey
- [ ] Browse merchants by tier
- [ ] View merchant details
- [ ] Add products to cart
- [ ] Merchant grouping in cart
- [ ] Checkout with delivery
- [ ] Checkout with pickup (QR code generation)
- [ ] View order history

#### Merchant Dashboard
- [ ] View dashboard statistics
- [ ] Add/edit/delete products
- [ ] Upload product images
- [ ] Manage orders
- [ ] Verify pickup codes (QR scanner)
- [ ] View pickup rewards
- [ ] Receive real-time notifications

#### Payment Processing
- [ ] Stripe payment intent creation
- [ ] Paymob payment flow
- [ ] Webhook handling (Stripe)
- [ ] Webhook handling (Paymob)
- [ ] Payment status updates

#### Notifications
- [ ] Real-time notification bell updates
- [ ] Toast notifications on new events
- [ ] Mark as read functionality
- [ ] Notification sound (optional)

#### Admin Panel
- [ ] Review pending merchant applications
- [ ] Approve/reject merchants
- [ ] Ban/unban merchants
- [ ] View platform analytics

---

## ğŸŒ Deployment

### Deploy to Vercel (Recommended)

1. **Push to GitHub** (if not already)
   ```bash
   git add .
   git commit -m "Ready for deployment"
   git push origin main
   ```

2. **Connect to Vercel**
   - Go to [vercel.com](https://vercel.com)
   - Import your GitHub repository
   - Configure environment variables
   - Deploy

3. **Environment Variables**
   - Add all `.env.local` variables in Vercel dashboard
   - Ensure `SUPABASE_SERVICE_ROLE_KEY` is added

4. **Configure Webhooks**
   - Update Stripe webhook URL: `https://yourdomain.com/api/webhooks/stripe`
   - Update Paymob webhook URL: `https://yourdomain.com/api/webhooks/paymob`

### Deploy to Other Platforms

EMall can be deployed to any platform supporting Next.js:
- **Netlify**
- **Railway**
- **DigitalOcean App Platform**
- **AWS Amplify**
- **Self-hosted** (Docker)

---

## ğŸ“ Project Structure

```
Emallv1.0/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (admin)/          # Admin dashboard routes
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â”œâ”€â”€ merchants/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ pending/  # Merchant approval page
â”‚   â”‚   â”‚       â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚       â””â”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ (auth)/            # Authentication routes
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”œâ”€â”€ (customer)/        # Customer-facing routes
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       # Homepage (merchants by tier)
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant/[id]/ # Merchant detail page
â”‚   â”‚   â”‚   â””â”€â”€ cart/          # Shopping cart with QR codes
â”‚   â”‚   â”œâ”€â”€ (merchant)/        # Merchant dashboard routes
â”‚   â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx         # Main dashboard
â”‚   â”‚   â”‚       â”œâ”€â”€ products/        # Product management
â”‚   â”‚   â”‚       â”œâ”€â”€ orders/          # Order management
â”‚   â”‚   â”‚       â”œâ”€â”€ rewards/         # Pickup rewards dashboard
â”‚   â”‚   â”‚       â”œâ”€â”€ verify-pickup/   # QR verification page
â”‚   â”‚   â”‚       â”œâ”€â”€ settings/
â”‚   â”‚   â”‚       â””â”€â”€ subscription/
â”‚   â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ create-payment-intent/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-subscription/
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ notify-merchant/
â”‚   â”‚   â”‚   â””â”€â”€ webhooks/
â”‚   â”‚   â”‚       â”œâ”€â”€ stripe/
â”‚   â”‚   â”‚       â””â”€â”€ paymob/
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # Root layout with Toaster
â”‚   â”‚   â””â”€â”€ globals.css        # Global styles
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”‚       â”œâ”€â”€ NotificationBell.tsx    # Real-time notification bell
â”‚   â”‚       â””â”€â”€ DashboardHeader.tsx     # Merchant dashboard header
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ supabase/
â”‚       â”‚   â”œâ”€â”€ client.ts      # Client-side Supabase
â”‚       â”‚   â””â”€â”€ server.ts      # Server-side Supabase
â”‚       â”œâ”€â”€ stripe.ts          # Stripe integration
â”‚       â”œâ”€â”€ paymob.ts          # Paymob integration
â”‚       â”œâ”€â”€ qrcode.ts          # QR code utilities
â”‚       â””â”€â”€ notifications.ts   # Notification system
â”œâ”€â”€ public/                    # Static assets
â”œâ”€â”€ .env.local                 # Environment variables (not in git)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ next.config.js
â””â”€â”€ README.md
```

### Key Directories Explained

#### `/app/(admin)` - Admin Dashboard
Protected routes for platform administrators to manage merchants, view analytics, and configure settings.

#### `/app/(customer)` - Customer Experience
Public-facing pages for browsing merchants, viewing products, and shopping.

#### `/app/(merchant)` - Merchant Dashboard
Protected merchant-only pages for managing products, orders, and viewing analytics.

#### `/app/api` - API Endpoints
Next.js API routes for payment processing, webhooks, and merchant notifications.

#### `/lib` - Utility Libraries
Reusable functions for Supabase, payments, QR codes, and notifications.

#### `/components` - React Components
Shared UI components like NotificationBell and DashboardHeader.

---

## ğŸ” Security Best Practices

### Environment Variables
- âœ… Never commit `.env.local` to git
- âœ… Use different keys for development and production
- âœ… Rotate service role keys regularly

### Supabase
- âœ… Use Row Level Security (RLS) policies
- âœ… Service role key only on server-side
- âœ… Validate user permissions in API routes

### Payment Processing
- âœ… Verify webhook signatures (Stripe, Paymob)
- âœ… Log all webhook events
- âœ… Use HTTPS in production
- âœ… Validate payment amounts server-side

### Authentication
- âœ… Use Supabase Auth built-in security
- âœ… Implement role-based access control
- âœ… Verify user permissions before actions

---

## ğŸ¤ Contributing

We welcome contributions! Please follow these guidelines:

### Development Workflow

1. **Fork the repository**
2. **Create a feature branch**
   ```bash
   git checkout -b feature/amazing-feature
   ```
3. **Make your changes**
4. **Test thoroughly**
5. **Commit with clear messages**
   ```bash
   git commit -m "Add amazing feature: description"
   ```
6. **Push to your fork**
   ```bash
   git push origin feature/amazing-feature
   ```
7. **Open a Pull Request**

### Code Standards

- Follow TypeScript best practices
- Use functional components with hooks
- Implement error handling
- Add comments for complex logic
- Follow existing code style
- Update documentation

### Commit Message Format

```
<type>: <description>

[optional body]
[optional footer]
```

Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

**Examples:**
```
feat: Add QR code pickup verification page
fix: Resolve notification bell dropdown closing issue
docs: Update installation instructions
```

---

## ğŸ“š API Documentation

### Notification API

#### Send Merchant Notification
```http
POST /api/orders/notify-merchant
Content-Type: application/json

{
  "orderId": "uuid-of-order"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Merchant notified successfully"
}
```

### Stripe API

#### Create Payment Intent
```http
POST /api/create-payment-intent
Content-Type: application/json

{
  "amount": 5000,
  "currency": "egp",
  "metadata": {
    "order_id": "uuid"
  }
}
```

#### Create Subscription
```http
POST /api/create-subscription
Content-Type: application/json

{
  "customerId": "cus_xxx",
  "priceId": "price_xxx"
}
```

---

## ğŸ› Troubleshooting

### Common Issues

#### Build Errors

**Issue:** `Module not found` errors
```bash
# Solution: Clean install
rm -rf node_modules package-lock.json
npm install
```

**Issue:** TypeScript errors
```bash
# Solution: Check TypeScript version
npm install -D typescript@latest
```

#### Supabase Connection

**Issue:** `Invalid API key` error
```bash
# Solution: Verify environment variables
# Ensure NEXT_PUBLIC_SUPABASE_URL and keys are correct
```

**Issue:** Realtime not working
```sql
-- Solution: Enable realtime for table
ALTER PUBLICATION supabase_realtime ADD TABLE notifications;
```

#### Payment Processing

**Issue:** Stripe webhook not receiving events
- Ensure webhook URL is correct: `https://yourdomain.com/api/webhooks/stripe`
- Check webhook signing secret matches
- Verify endpoint is not behind authentication

**Issue:** Paymob HMAC verification fails
- Ensure HMAC secret matches Paymob dashboard
- Check field order in HMAC calculation
- Verify all 20 required fields are included

---

## ğŸ“ License

This project is private and proprietary. All rights reserved.

---

## ğŸ‘¥ Team

- **Project Lead** - Platform architecture and development
- **Backend** - Supabase, payment integrations
- **Frontend** - Next.js, React components
- **DevOps** - Deployment and infrastructure

---

## ğŸ“ Support

For issues and questions:

- ğŸ“§ **Email:** support@emall.example.com
- ğŸ› **Bug Reports:** [GitHub Issues](https://github.com/yuosef0/Emallv1.0/issues)
- ğŸ“– **Documentation:** This README

---

## ğŸ—ºï¸ Roadmap

### Phase 1: Core Platform âœ…
- [x] User authentication and roles
- [x] Merchant dashboard
- [x] Product management
- [x] Shopping cart
- [x] Order management

### Phase 2: Advanced Features âœ…
- [x] QR pickup system
- [x] Payment integration (Stripe + Paymob)
- [x] Notification system
- [x] Pickup rewards

### Phase 3: Enhancements ğŸš§
- [ ] Customer reviews and ratings
- [ ] Advanced search and filters
- [ ] Email notifications (SendGrid)
- [ ] SMS notifications (Twilio)
- [ ] Mobile app (React Native)

### Phase 4: Scale ğŸ“…
- [ ] Multi-language support
- [ ] Analytics dashboard improvements
- [ ] Marketing tools
- [ ] API for third-party integrations
- [ ] Performance optimizations

---

## ğŸ™ Acknowledgments

- **Next.js Team** - Amazing framework
- **Supabase** - Backend-as-a-Service platform
- **Stripe** - Payment processing
- **Paymob** - Egyptian payment gateway
- **Vercel** - Hosting and deployment
- **Open Source Community** - All the amazing libraries

---

<div align="center">

**Built with â¤ï¸ for Egyptian merchants**

![Made with Next.js](https://img.shields.io/badge/Made%20with-Next.js-black?style=flat-square&logo=next.js)
![Powered by Supabase](https://img.shields.io/badge/Powered%20by-Supabase-green?style=flat-square&logo=supabase)
![TypeScript](https://img.shields.io/badge/TypeScript-Ready-blue?style=flat-square&logo=typescript)

</div>
